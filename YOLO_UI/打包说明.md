# YOLO训练工具EXE打包指南

## 快速开始

### 方法一：使用自动打包脚本（推荐）

1. 确保在 `YOLO_UI` 目录下
2. 双击运行 `build_exe.bat`
3. 等待打包完成

### 方法二：手动打包

```bash
# 1. 安装PyInstaller
pip install pyinstaller

# 2. 进入YOLO_UI目录
cd YOLO_UI

# 3. 执行打包命令
pyinstaller yolo_ui.spec --clean
```

## 打包前准备

### 1. 环境检查
确保已安装所有依赖：
```bash
pip install -r requirements.txt
# 或者GPU版本
pip install -r requirements-gpu.txt
```

### 2. 清理旧文件
```bash
# 删除之前的构建文件
rmdir /s build dist __pycache__
```

### 3. 测试程序
在打包前确保程序能正常运行：
```bash
python main.py
```

## 打包配置说明

### spec文件关键配置

- **hiddenimports**: 包含了所有必要的隐含导入模块
- **datas**: 包含了UI资源、数据文件、模型文件等
- **excludes**: 排除了测试文件和不必要的模块
- **console=False**: 隐藏控制台窗口（GUI应用）
- **upx=True**: 启用UPX压缩减小文件大小

### 包含的文件和目录

- `ui/`: 所有UI组件和资源文件
- `data/`: 配置文件和设置
- `utils/`: 工具模块
- `datasets/`: 示例数据集（可选）
- `*.pt`: 模型文件
- `*.yaml/.yml`: 配置文件

## 打包后的文件结构

```
dist/
└── YOLO_Training_Tool/
    ├── YOLO_Training_Tool.exe  # 主程序
    ├── 各种DLL文件
    ├── ui/                     # UI资源
    ├── data/                   # 数据文件
    ├── utils/                  # 工具模块
    └── 其他依赖文件
```

## 常见问题解决

### 1. 打包失败

**问题**: `ModuleNotFoundError`
```
解决方案:
- 检查 hiddenimports 列表
- 确保所有依赖都已安装
- 尝试手动添加缺失的模块到spec文件
```

**问题**: 内存不足
```
解决方案:
- 关闭其他程序释放内存
- 如果数据集很大，考虑从datas中移除datasets目录
- 增加虚拟内存
```

### 2. 运行时错误

**问题**: DLL缺失
```
解决方案:
- 安装 Visual C++ Redistributable
- 使用 --add-binary 参数手动添加DLL
```

**问题**: 找不到资源文件
```
解决方案:
- 检查datas配置是否正确
- 确保资源文件路径使用相对路径
- 使用 sys._MEIPASS 获取临时目录路径
```

### 3. 文件过大

**问题**: EXE文件太大（>1GB）
```
解决方案:
- 移除datasets目录: 在spec文件中注释掉 ('datasets', 'datasets')
- 移除大的模型文件，改为首次运行时下载
- 使用 --exclude-module 排除更多不需要的模块
```

## 优化建议

### 1. 减小文件大小

```python
# 在spec文件中添加更多排除项
excludes=[
    'matplotlib.tests',
    'numpy.tests', 
    'PIL.tests',
    'unittest',
    'test',
    'tests',
    'setuptools',
    'distutils',
    'tkinter',  # 如果不使用tkinter
    'IPython',  # 如果不使用IPython
]
```

### 2. 提高启动速度

- 将大文件（如数据集）放在外部目录
- 使用懒加载导入重模块
- 考虑使用 `--onefile` 但会增加启动时间

### 3. 创建安装包

使用NSIS或Inno Setup创建专业的安装程序：

```nsis
; 示例NSIS脚本
!define APP_NAME "YOLO Training Tool"
!define APP_VERSION "1.0"

Name "${APP_NAME}"
OutFile "YOLO_Training_Tool_Setup.exe"
InstallDir "$PROGRAMFILES\${APP_NAME}"

Section
    SetOutPath $INSTDIR
    File /r "dist\YOLO_Training_Tool\*"
    CreateShortCut "$DESKTOP\${APP_NAME}.lnk" "$INSTDIR\YOLO_Training_Tool.exe"
SectionEnd
```

## 分发注意事项

### 1. 系统要求

- Windows 10/11 (64位)
- 至少4GB内存
- 2GB可用磁盘空间
- 支持DirectX 11的显卡（GPU加速）

### 2. 依赖说明

打包后的程序包含了所有Python依赖，但可能还需要：
- Visual C++ Redistributable 2019-2022
- .NET Framework 4.7.2+（某些组件需要）

### 3. 首次运行

- 首次启动可能需要30秒到2分钟
- 建议在程序目录有写权限的位置运行
- 如有杀毒软件误报，请添加到白名单

## 高级配置

### 1. 自定义图标

```python
# 替换spec文件中的图标路径
icon=os.path.join('.', 'ui', 'assets', 'custom_icon.ico')
```

### 2. 版本信息

```python
# 添加版本信息到spec文件
exe = EXE(
    # ... 其他参数
    version='version_info.txt'  # 需要创建版本信息文件
)
```

### 3. 数字签名

```bash
# 使用signtool进行数字签名
signtool sign /f mycert.pfx /p password YOLO_Training_Tool.exe
```

## 故障排除

### 日志收集

如果遇到问题，可以：

1. 临时启用控制台查看错误：`console=True`
2. 添加详细日志记录
3. 使用 `--debug=all` 参数重新打包

### 测试清单

- [ ] 程序能正常启动
- [ ] UI界面显示正常
- [ ] 所有功能模块可用
- [ ] 文件路径访问正常
- [ ] GPU检测正常（如果适用）
- [ ] 模型加载正常
- [ ] 训练功能可用

## 性能监控

建议在打包后测试：
- 内存使用情况
- 启动时间
- 功能响应速度
- 文件I/O性能

---

*本指南持续更新，如遇到新问题请及时记录解决方案。*